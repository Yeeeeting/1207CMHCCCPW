<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- [已修改] 更新網頁標題 -->
    <title>臨床能力委員會(CCC)實務工作坊報名</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- 自訂 Tailwind 主題 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        'deep-blue': '#0A3B5C',      // 主標題深藍色
                        'secondary-blue': '#1E5F8A', // 次要標題/標籤
                        'brick-red': '#C64E35',     // 強調/按鈕
                        'light-khaki': '#E9DCC5',   // 區塊背景/點綴
                        'off-white': '#F8F6F2',    // 頁面主背景
                        'dark-text': '#2D2D2D',      // 深色內文
                    },
                    // [新增] 配合提示框換行
                    spacing: {
                        'xs': '20rem', // ~320px
                    }
                }
            }
        }
    </script>
    
    <!-- 自訂表單元素樣式 -->
    <style>
        input[type="text"],
        input[type="email"],
        select {
            width: 100%;
            border: 1px solid #1E5F8A; /* border-secondary-blue */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem; /* p-2 */
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        select:focus {
            border-color: #C64E35; /* focus:border-brick-red */
            box-shadow: 0 0 0 3px rgba(198, 78, 53, 0.25); /* focus:ring focus:ring-brick-red focus:ring-opacity-25 */
            outline: 2px solid transparent;
            outline-offset: 2px;
        }

        input[type="radio"],
        input[type="checkbox"] {
            @apply h-4 w-4 text-brick-red border-gray-400 focus:ring-brick-red;
        }

        :root {
            scroll-padding-top: 150px; 
        }

        /* 浮動提示框樣式 (PGY 範例) */
        #toast-container {
            position: fixed;
            inset-x: 0;
            top: 1rem; /* 16px */
            z-index: 60; /* 確保在 table tooltip 之上 */
            display: flex;
            justify-content: center;
            pointer-events: none;
        }
        #toast-box {
            padding: 1rem; /* p-4 */
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 700; /* font-bold */
            transition-property: all;
            transition-duration: 300ms; /* duration-300 */
            transform: translateY(-150%);
            opacity: 0;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
            min-width: 300px;
            text-align: center;
        }
    </style>
</head>

<body class="bg-off-white font-sans text-dark-text antialiased">

    <!-- 
      固定在頂部的容器 (標題 + 導覽列)
    -->
    <div class="sticky top-0 z-40 shadow-lg rounded-b-xl"> <!-- z-40 確保在 table tooltip 之下 -->
        
        <!-- 1. 標題區塊 -->
        <header class="bg-deep-blue text-white h-20 flex items-center justify-center px-4">
            <!-- [已修改] 更新H1主標題 -->
            <h1 class="text-2xl sm:text-3xl font-bold tracking-wider text-center">
                臨床能力委員會(CCC)實務工作坊
            </h1>
        </header>

        <!-- 2. 導覽列區塊 -->
        <nav class="bg-light-khaki">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-center items-center h-16">
                    <div class="space-x-10">
                        <a href="#info" data-navlink="info" class="font-bold text-secondary-blue hover:text-brick-red transition-colors duration-200 pb-1">活動資訊</a>
                        <a href="#register" data-navlink="register" class="font-bold text-secondary-blue hover:text-brick-red transition-colors duration-200 pb-1">線上報名</a>
                        <a href="#agenda" data-navlink="agenda" class="font-bold text-secondary-blue hover:text-brick-red transition-colors duration-200 pb-1">活動議程</a>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- 主要內容容器 -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <div class="space-y-12">

            <!-- 
              區塊 1: 活動資訊 
            -->
            <div id="info" class="bg-white rounded-xl shadow-md overflow-hidden p-6 sm:p-8">
                <h2 class="text-3xl font-bold tracking-tight text-secondary-blue mb-6">活動資訊</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-6 text-base">
                    <!-- 左側：目的與目標 -->
                    <div class="md:col-span-2 space-y-5">
                        <div>
                            <h3 class="text-xl font-semibold text-deep-blue mb-2">目的</h3>
                            <p class="text-gray-700 leading-relaxed">
                                本次工作坊邀請臺大醫院楊志偉醫師指導，以CCC（Clinical Competency Committee，臨床能力委員會）之運作為主軸，強調信賴評定是以病人安全為核心的風險判断而非單純分數評量，並同步培育院內種子教師，建立可複製的會議模式至回饋流程，整體主要分為下列三個目標：
                            </p>
                            <ul class="list-decimal list-inside text-gray-700 leading-relaxed mt-3 space-y-1 pl-2">
                                <li>目標一 熟悉CCC運作模式：讓教師們熟悉如何進行CCC會議，包括如何開會、促進討論、委員組成及下達信賴決策等。</li>
                                <li>目標二 制定補強計畫(Remediation Plan)：根據CCC討論結果制定針對學員的客製化補強計畫(Tailor-made program design and remediation)。</li>
                                <li>目標三 (ADAPT)演練回饋技巧：如何對學員進行補強計劃和CCC評定結果的回饋模板演練。</li>
                            </ul>
                        </div>
                        
                        <!-- 學分區塊 -->
                        <div>
                            <h3 class="text-xl font-semibold text-deep-blue mb-2">學分</h3>
                            <p class="text-gray-700 leading-relaxed">
                                全程參與臨床教師認證C類教學技巧5學分、進階2分；衛福部醫師、護理師繼續教育學分申請中
                            </p>
                        </div>
                    </div>
                    
                    <!-- 右側：詳細資訊 -->
                    <div class="md:col-span-1 bg-light-khaki bg-opacity-60 rounded-lg p-5 space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">日期</h3>
                            <p class="text-gray-700">2025年12月7日 (日)</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">時間</h3>
                            <p class="text-gray-700">09:00 - 16:00 (08:45 開始報到)</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">地點</h3>
                            <p class="text-gray-700">第五醫療大樓五樓國際會議廳、552會議室、554會議室、556會議室、558會議室</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">講師</h3>
                            <p class="text-gray-700">臺大醫院 楊志偉 醫師</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 
              區塊 2: 線上報名 
            -->
            <div id="register" class="bg-white rounded-xl shadow-md overflow-hidden p-6 sm:p-8">
                <!-- flex 佈局，並加入報名狀態 ID -->
                <div class="flex flex-wrap items-baseline gap-x-4 gap-y-2 mb-6">
                    <h2 class="text-3xl font-bold tracking-tight text-secondary-blue">線上報名</h2>
                    <!-- 此 span 用於顯示報名狀態 -->
                    <span id="registrationStatus" class="text-xl font-medium text-teal-600">讀取報名狀態中...</span>
                    <!-- [新增] 顯示目標受眾文字 -->
                    <span id="audienceText" class="text-base font-medium text-gray-600 hidden">(各科部及職類之教學訓練計畫主持人(負責人)、臨床教師)</span>
                </div>
                
                <form id="registrationForm" class="space-y-5">
                    <!-- 姓名 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                        <div>
                            <label for="name" class="block text-sm font-medium text-secondary-blue">姓名</label>
                            <input type="text" name="name" id="name" required class="mt-1">
                        </div>
                        <!-- 人事號 -->
                        <div>
                            <label for="employeeId" class="block text-sm font-medium text-secondary-blue">人事號</label>
                            <input type="text" name="employeeId" id="employeeId" required class="mt-1">
                        </div>
                        <!-- 電子郵件 -->
                        <div>
                            <label for="email" class="block text-sm font-medium text-secondary-blue">電子郵件 (E-mail)</label>
                            <input type="email" name="email" id="email" required class="mt-1">
                        </div>
                        <!-- 連絡分機 -->
                        <div>
                            <label for="extension" class="block text-sm font-medium text-secondary-blue">連絡分機或簡碼</label>
                            <input type="text" name="extension" id="extension" class="mt-1">
                        </div>
                        <!-- 職類 -->
                        <div>
                            <label for="jobCategory" class="block text-sm font-medium text-secondary-blue">職類</label>
                            <select id="jobCategory" name="jobCategory" required class="mt-1">
                                <option value="">-- 請選擇您的職類 --</option>
                                <option value="西醫">西醫</option>
                                <option value="牙醫">牙醫</option>
                                <option value="中醫">中醫</option>
                                <option value="護理">護理</option>
                                <option value="藥事">藥事</option>
                                <option value="醫事放射">醫事放射</option>
                                <option value="醫事檢驗">醫事檢驗</option>
                                <option value="營養">營養</option>
                                <option value="呼吸治療">呼吸治療</option>
                                <option value="聽力">聽力</option>
                                <option value="職能治療">職能治療</option>
                                <option value="物理治療">物理治療</option>
                                <option value="臨床心理">臨床心理</option>
                                <option value="語言治療">語言治療</option>
                                <option value="行政人員">行政人員</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <!-- 臨床教學經驗 -->
                        <div>
                            <label for="experience" class="block text-sm font-medium text-secondary-blue">臨床教學經驗</label>
                            <select id="experience" name="experience" required class="mt-1">
                                <option value="">-- 請選擇您的資歷 --</option>
                                <option value="1-5年">1-5年</option>
                                <option value="5-10年">5-10年</option>
                                <option value="10年以上">10年以上</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 臨床教學職位 (可複選) -->
                    <div>
                        <label class="block text-sm font-medium text-secondary-blue">臨床教學職位 (可複選)</label>
                        <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-6">
                            <div class="flex items-center">
                                <input id="role-head" name="role" type="checkbox" value="教學訓練計畫主持人" class="p-2">
                                <label for="role-head" class="ml-2 block text-sm text-gray-800">教學訓練計畫主持人</label>
                            </div>
                            <div class="flex items-center">
                                <input id="role-chief" name="role" type="checkbox" value="科部教學負責人" class="p-2">
                                <label for="role-chief" class="ml-2 block text-sm text-gray-800">科部教學負責人</label>
                            </div>
                            <div class="flex items-center">
                                <input id="role-teacher" name="role" type="checkbox" value="臨床教師" class="p-2">
                                <label for="role-teacher" class="ml-2 block text-sm text-gray-800">臨床教師</label>
                            </div>
                        </div>
                    </div>

                    <!-- 午餐 -->
                    <div>
                        <label class="block text-sm font-medium text-secondary-blue">午餐</label>
                        <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-6">
                            <div class="flex items-center">
                                <input id="diet-meat" name="diet" type="radio" value="葷食" required class="p-2">
                                <label for="diet-meat" class="ml-2 block text-sm text-gray-800">葷食</label>
                            </div>
                            <div class="flex items-center">
                                <input id="diet-veg" name="diet" type="radio" value="素食" class="p-2">
                                <label for="diet-veg" class="ml-2 block text-sm text-gray-800">素食</label>
                            </div>
                            <div class="flex items-center">
                                <input id="diet-none" name="diet" type="radio" value="不需要" class="p-2">
                                <label for="diet-none" class="ml-2 block text-sm text-gray-800">不需要，可自理</label>
                            </div>
                        </div>
                    </div>

                    <!-- 報名按鈕區塊 -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-4">
                        <button type="submit" id="submitButton" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-brick-red hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brick-red transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg id="spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span id="buttonText">確認報名</span>
                        </button>
                        
                        <button type="button" id="googleCalendarButton" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-secondary-blue bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-blue transition-colors duration-200">
                            <!-- SVG icon (calendar-days) -->
                            <svg class="w-5 h-5 mr-2 -ml-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor">
                                <path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64V24c0-13.3-10.7-24-24-24S16 10.7 16 24V64H0V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V64H336V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM0 192H448V448c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192zm384-96H64v32H384V96z"/>
                            </svg>
                            加入 Google 行事曆
                        </button>
                    </div>
                </form>
                
                <!-- 報名成功提示 (靜態) -->
                <div id="successMessage" class="hidden mt-6 p-4 rounded-md bg-green-100 border border-green-300 text-green-800">
                    <h3 class="font-medium">報名成功！</h3>
                    <p>感謝您的報名，我們已收到您的資料。將會在會前1周內寄出分組名單及教案等資訊給您！</p>
                </div>

                <!-- 浮動訊息/錯誤提示區 (Toast) -->
                <div id="toast-container">
                    <div id="toast-box"></div>
                </div>
            </div>

            <!-- 
              區塊 3: 活動議程 
            -->
            <div id="agenda" class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-6 sm:p-8">
                  <h2 class="text-3xl font-bold tracking-tight text-secondary-blue mb-6">活動議程</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full text-base">
                        <thead class="bg-deep-blue text-white">
                            <tr>
                                <th scope="col" class="py-3.5 px-4 text-left font-semibold">時間</th>
                                <th scope="col" class="py-3.5 px-4 text-left font-semibold">主題</th>
                                <th scope="col" class="py-3.5 px-4 text-left font-semibold">地點</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            
                            <!-- 09:00 - 09:10 -->
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">09:00 - 09:10</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    長官致詞
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                            <!-- 09:10 - 10:00 -->
                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">09:10 - 10:00</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative group-hover:z-10">
                                    Lecture：CCC核心概念
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-50 mb-2 w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-normal">
                                        了解CCC運作
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>
                            
                            <!-- 10:00 - 10:10 -->
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">10:00 - 10:10</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    Coffee Break
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">-</td>
                            </tr>

                            <!-- 10:10 - 12:00 [已整併] -->
                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">10:10 - 12:00</td>
                                <td class="px-4 py-4 whitespace-normal text-gray-900 group relative group-hover:z-10">
                                    CCC信賴評定演練、結果分享與討論交流
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-50 mb-2 w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-normal">
                                        預計演練2個教案，委員解讀Portfolio並提出觀察、主席彙整意見、共同做出信賴評定
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳、552、554、556、558 會議室</td>
                            </tr>

                            <!-- 12:00 - 13:00 [時間調整] -->
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">12:00 - 13:00</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    休息
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">-</td>
                            </tr>

                            <!-- 13:00 - 14:00 [已整併] -->
                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">13:00 - 14:00</td>
                                <td class="px-4 py-4 whitespace-normal text-gray-900 group relative group-hover:z-10">
                                    Lecture：補強計畫說明、補強計畫設計演練
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-50 mb-2 w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-normal">
                                        釐清問題、設定目標、選擇策略兼顧可行性
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>
                            
                            <!-- 14:00 - 16:00 [大時段整併] -->
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">14:00 - 16:00</td>
                                <td class="px-4 py-4 whitespace-normal text-gray-900 group relative group-hover:z-10">
                                    Lecture：ADAPT回饋模組與輔導技巧說明、ADAPT回饋演練、共識(各科下一步)與綜合討論
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-50 mb-2 w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-normal">
                                        介紹ADAPT回饋模組之概念講解、示範演練、分組實作
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-normal text-gray-700">
                                    國際會議廳、552、554、556、558 會議室
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- 頁尾 -->
    <footer class="bg-deep-blue text-white mt-16 py-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>主辦單位：教學部</p>
            <p class="mt-1">聯絡人：楊宜婷教學行政管理員 (分機: 57431、 57429；信箱: a80740@mail.chimei.org.tw)</p>
        </div>
    </footer>


    <!-- 
      JavaScript 程式碼 (採用 PGY 範例模式)
    -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- 全域變數與 DOM 元素 ---
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyopfC_426aVcGXDNzzqO9mlPUqz8IUWEEfKHjYF3Hp7ebiWRffwvVhGNPVb5cmkBsFZA/exec"; 

            const form = document.getElementById('registrationForm');
            const submitButton = document.getElementById('submitButton');
            const buttonText = document.getElementById('buttonText');
            const spinner = document.getElementById('spinner');
            const toastBox = document.getElementById('toast-box');
            const registrationStatus = document.getElementById('registrationStatus');
            const successMessageDiv = document.getElementById('successMessage'); 
            const audienceText = document.getElementById('audienceText'); // [新增] 目標受眾

            // --- 核心功能函式 ---

            /**
             * 顯示浮動提示 (用於錯誤)
             */
            function showMessage(text, isError = false) {
                toastBox.textContent = text;
                toastBox.className = 'p-4 rounded-xl font-bold transition-all duration-300 transform shadow-2xl min-w-[300px] text-center';
                
                if (isError) {
                    toastBox.classList.add('bg-red-100', 'text-red-700');
                } else {
                    toastBox.classList.add('bg-green-100', 'text-green-700');
                }
                
                toastBox.classList.remove('translate-y-[-150%]', 'opacity-0');
                toastBox.classList.add('translate-y-0', 'opacity-100');
                
                setTimeout(() => {
                    toastBox.classList.remove('translate-y-0', 'opacity-100');
                    toastBox.classList.add('translate-y-[-150%]', 'opacity-0');
                }, 5000);
            }

            /**
             * 設定按鈕的提交狀態
             */
            function setSubmitting(isSubmitting, text) {
                submitButton.disabled = isSubmitting;
                buttonText.textContent = text || (isSubmitting ? '處理中...' : '確認報名');
                spinner.classList.toggle('hidden', !isSubmitting);
            }

            /**
             * 禁用或啟用整個表單
             */
            function disableForm(disabled) {
                setSubmitting(disabled, disabled ? '報名已額滿' : '確認報名');
                form.querySelectorAll('input, select, button').forEach(el => {
                    if (el.id !== 'googleCalendarButton') {
                        el.disabled = disabled;
                    }
                });
            }

            /**
             * 檢查報名狀態
             */
            async function checkRegistrationStatus() {
                // [修改] 預設顯示 60 人，並隱藏受眾文字
                registrationStatus.textContent = '本活動上限60人';
                registrationStatus.className = 'text-xl font-medium text-teal-600';
                audienceText.classList.add('hidden');

                try {
                    const response = await fetch(`${SCRIPT_URL}?action=checkCapacity`, {
                        method: 'GET',
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP 錯誤! 狀態: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        const statusData = result.data;
                        if (statusData.status === 'closed') {
                            registrationStatus.textContent = '報名已額滿';
                            registrationStatus.className = 'text-xl font-medium text-red-600'; 
                            audienceText.classList.add('hidden'); // 額滿時隱藏
                            disableForm(true); 
                        } else {
                            // [修改] 開放時，顯示 60 人上限 + 受眾文字
                            registrationStatus.textContent = '本活動上限60人';
                            registrationStatus.className = 'text-xl font-medium text-teal-600'; 
                            audienceText.classList.remove('hidden'); // 開放時顯示
                            disableForm(false); 
                        }
                    } else {
                        throw new Error(result.message || '無法解析報名狀態');
                    }
                } catch (error) {
                    console.error('Error fetching registration status:', error);
                    registrationStatus.textContent = '無法讀取報名狀態';
                    registrationStatus.className = 'text-xl font-medium text-amber-600';
                    audienceText.classList.add('hidden'); // 讀取失敗時隱藏
                    setSubmitting(false); // 確保按鈕可用
                    showMessage(`讀取狀態失敗: ${error.message}。請檢查 GAS 部署是否正確。`, true);
                }
            }


            /**
             * 表單提交邏輯
             */
            form.addEventListener('submit', async function (e) {
                e.preventDefault(); 
                
                setSubmitting(true, '報名資料送出中...');
                successMessageDiv.classList.add('hidden');

                // 手動收集表單資料
                const formData = new FormData(form);
                const data = {};
                
                formData.forEach((value, key) => {
                    if (key !== 'role') {
                        data[key] = value;
                    }
                });
                
                const roles = formData.getAll('role');
                data.roles = roles; 
                
                try {
                    const params = new URLSearchParams();
                    params.append('payload', JSON.stringify(data));

                    const response = await fetch(SCRIPT_URL, { 
                        method: 'POST', 
                        body: params 
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP 錯誤! 狀態: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.success) {
                        // 顯示靜態綠色提示框
                        successMessageDiv.classList.remove('hidden');
                        successMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        form.reset();
                        
                        if (result.data && result.data.status === 'closed') {
                            registrationStatus.textContent = '報名已額滿';
                            registrationStatus.className = 'text-xl font-medium text-red-600';
                            audienceText.classList.add('hidden'); // 額滿時隱藏
                            disableForm(true); 
                        } else {
                            setSubmitting(false);
                            // 成功後保持開放狀態，受眾文字也應保持顯示
                            audienceText.classList.remove('hidden');
                        }
                        
                    } else {
                        // 報名失敗 (例如：已額滿、GAS 內部錯誤)
                        showMessage(result.message || '報名失敗，請稍後再試', true);
                        setSubmitting(false); 
                        
                        if (result.isCapacityError) {
                            registrationStatus.textContent = '報名已額滿';
                            registrationStatus.className = 'text-xl font-medium text-red-600';
                            audienceText.classList.add('hidden'); // 額滿時隱藏
                            disableForm(true);
                        }
                    }
                } catch (error) {
                    console.error('Submit Error:', error);
                    showMessage(`提交失敗: ${error.message}。請檢查網路連線或稍後再試。`, true);
                    setSubmitting(false); 
                }
            });

            // --- Google 行事曆邏輯 ---
            const googleCalendarButton = document.getElementById('googleCalendarButton');
            
            if (googleCalendarButton) {
                googleCalendarButton.addEventListener('click', function () {
                    
                    const event = {
                        title: "臨床能力委員會(CCC)實務工作坊",
                        startDate: "20251207T090000", 
                        endDate: "20251207T160000",   
                        timeZone: "Asia/Taipei", 
                        location: "第五醫療大樓五樓國際會議廳、552會議室、554會議室、556會議室、558會議室",
                        description: "本次工作坊邀請臺大醫院楊志偉醫師指導，以CCC（Clinical Competency Committee，臨床能力委員會）之運作為主軸，強調信賴評定是以病人安全為核心的風險判斷而非單純分數評量。"
                    };

                    const baseUrl = "https://www.google.com/calendar/render?action=TEMPLATE";
                    const params = new URLSearchParams({
                        'text': event.title,
                        'dates': `${event.startDate}/${event.endDate}`,
                        'ctz': event.timeZone,
                        'details': event.description,
                        'location': event.location
                    });

                    const url = `${baseUrl}&${params.toString()}`;
                    
                    window.open(url, '_blank');
                });
            }


            // --- D導覽列滾動偵測 (Scroll-Spy) 邏輯 ---
            const sections = document.querySelectorAll('main > div > div[id]');
            const navLinks = document.querySelectorAll('nav a[data-navlink]');
            const offset = 160; 

            function onScroll() {
                let current = '';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - offset) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('text-brick-red', 'border-b-2', 'border-brick-red');
                    if (link.dataset.navlink === current) {
                        link.classList.add('text-brick-red', 'border-b-2', 'border-brick-red');
                    }
                });
            }
            
            window.addEventListener('scroll', onScroll);
            onScroll(); 

            // --- 程式進入點 ---
            checkRegistrationStatus(); 

        }); 
    </script>

</body>
</html>
