<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(CCC)臨床能力評估委員會工作坊報名</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- 自訂 Tailwind 主題 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        'deep-blue': '#0A3B5C',      // 主標題深藍色
                        'secondary-blue': '#1E5F8A', // 次要標題/標籤
                        'brick-red': '#C64E35',     // 強調/按鈕
                        'light-khaki': '#E9DCC5',   // 區塊背景/點綴
                        'off-white': '#F8F6F2',    // 頁面主背景
                        'dark-text': '#2D2D2D',      // 深色內文
                    }
                }
            }
        }
    </script>
    
    <!-- 自訂表單元素樣式 -->
    <style>
        /* [已修改] 
          將表單樣式移出 @layer base，並棄用 @apply，
          改用標準 CSS 語法以強制瀏覽器渲染框線。
        */
        input[type="text"],
        input[type="email"],
        select {
            width: 100%;
            border: 1px solid #1E5F8A; /* border-secondary-blue */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem; /* p-2 */
        }

        /* [新增] 補回 :focus 樣式 */
        input[type="text"]:focus,
        input[type="email"]:focus,
        select:focus {
            border-color: #C64E35; /* focus:border-brick-red */
            box-shadow: 0 0 0 3px rgba(198, 78, 53, 0.25); /* focus:ring focus:ring-brick-red focus:ring-opacity-25 */
            outline: 2px solid transparent;
            outline-offset: 2px;
        }

        input[type="radio"],
        input[type="checkbox"] {
            @apply h-4 w-4 text-brick-red border-gray-400 focus:ring-brick-red;
        }

        /* 調整滾動時的錨點偏移，避免被固定的標題遮住 */
        /* 標頭(h-20) + 導覽列(h-16) = 144px。設定一個緩衝值 */
        :root {
            scroll-padding-top: 150px; 
        }
    </style>
</head>

<body class="bg-off-white font-sans text-dark-text antialiased">

    <!-- 
      固定在頂部的容器 (標題 + 導覽列)
    -->
    <div class="sticky top-0 z-50 shadow-lg rounded-b-xl">
        
        <!-- 1. 標題區塊 -->
        <header class="bg-deep-blue text-white h-20 flex items-center justify-center px-4">
            <h1 class="text-2xl sm:text-3xl font-bold tracking-wider text-center">
                (CCC)臨床能力評估委員會工作坊
            </h1>
        </header>

        <!-- 2. 導覽列區塊 -->
        <nav class="bg-light-khaki">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-center items-center h-16">
                    <div class="space-x-10">
                        <!-- 
                          - 為連結加上 pb-1 (padding-bottom: 0.25rem)
                          - 讓底線 (border-bottom) 出現時有足夠空間
                        -->
                        <a href="#info" data-navlink="info" class="font-bold text-secondary-blue hover:text-brick-red transition-colors duration-200 pb-1">活動資訊</a>
                        <a href="#register" data-navlink="register" class="font-bold text-secondary-blue hover:text-brick-red transition-colors duration-200 pb-1">線上報名</a>
                        <a href="#agenda" data-navlink="agenda" class="font-bold text-secondary-blue hover:text-brick-red transition-colors duration-200 pb-1">活動議程</a>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- 主要內容容器 -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <div class="space-y-12">

            <!-- 
              區塊 1: 活動資訊 
            -->
            <div id="info" class="bg-white rounded-xl shadow-md overflow-hidden p-6 sm:p-8">
                <h2 class="text-3xl font-bold tracking-tight text-secondary-blue mb-6">活動資訊</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-6 text-base">
                    <!-- 左側：目的與目標 -->
                    <div class="md:col-span-2 space-y-5">
                        <div>
                            <h3 class="text-xl font-semibold text-deep-blue mb-2">目的</h3>
                            <p class="text-gray-700 leading-relaxed">
                                本次工作坊邀請臺大醫院楊志偉醫師指導，以CCC（Clinical Competency Committee，臨床能力評估委員會）之運作為主軸，強調信賴評定是以病人安全為核心的風險判斷而非單純分數評量，並同步培育院內種子教師，建立可複製的會議模式至回饋流程，整體主要分為下列三個目標：
                            </p>
                            <ul class="list-decimal list-inside text-gray-700 leading-relaxed mt-3 space-y-1 pl-2">
                                <li>目標一 熟悉信賴決策(CCC運作模式)：讓教師們熟悉如何進行CCC會議，包括如何開會、促進討論、委員組成及下達信賴決策等。</li>
                                <li>目標二 制定補強計畫(Remediation Plan)：根據CCC討論結果制定針對學員的客製化補強計畫(Tailor-made program design and remediation)。</li>
                                <li>目標三 (ADAPT)演練回饋技巧：如何對學員進行補強計劃和CCC評定結果的回饋模板演練。</li>
                            </ul>
                        </div>
                        
                        <!-- 學分區塊 (已移至此處) -->
                        <div>
                            <h3 class="text-xl font-semibold text-deep-blue mb-2">學分</h3>
                            <p class="text-gray-700 leading-relaxed">
                                全程參與臨床教師認證C類教學技巧5學分、進階2分
                            </p>
                        </div>
                    </div>
                    
                    <!-- 右側：詳細資訊 (已加大間距為 space-y-6) -->
                    <div class="md:col-span-1 bg-light-khaki bg-opacity-60 rounded-lg p-5 space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">日期</h3>
                            <p class="text-gray-700">2025年12月7日 (日)</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">時間</h3>
                            <p class="text-gray-700">09:00 - 16:00 (08:45 開始報到)</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">地點</h3>
                            <p class="text-gray-700">第五醫療大樓五樓國際會議廳、552會議室、554會議室、556會議室、558會議室</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue">講師</h3>
                            <p class="text-gray-700">臺大醫院 楊志偉 醫師</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 
              區塊 2: 線上報名 
            -->
            <div id="register" class="bg-white rounded-xl shadow-md overflow-hidden p-6 sm:p-8">
                <h2 class="text-3xl font-bold tracking-tight text-secondary-blue mb-6">線上報名</h2>
                
                <form id="registrationForm" class="space-y-5">
                    <!-- 姓名 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                        <div>
                            <!-- [已修改] 移除 (必填) -->
                            <label for="name" class="block text-sm font-medium text-secondary-blue">姓名</label>
                            <!-- 
                              [註] 移除多餘的 p-2，樣式已由 <style> 標籤全局控制
                            -->
                            <input type="text" name="name" id="name" required class="mt-1">
                        </div>
                        <!-- 人事號 -->
                        <div>
                            <!-- [已修改] 移除 (必填) -->
                            <label for="employeeId" class="block text-sm font-medium text-secondary-blue">人事號</label>
                            <input type="text" name="employeeId" id="employeeId" required class="mt-1">
                        </div>
                        <!-- 電子郵件 -->
                        <div>
                            <!-- [已修改] 移除 (必填) -->
                            <label for="email" class="block text-sm font-medium text-secondary-blue">電子郵件 (E-mail)</label>
                            <input type="email" name="email" id="email" required class="mt-1">
                        </div>
                        <!-- [新增] 連絡分機 -->
                        <div>
                            <label for="extension" class="block text-sm font-medium text-secondary-blue">連絡分機或簡碼</label>
                            <input type="text" name="extension" id="extension" class="mt-1">
                        </div>
                        <!-- 職類 -->
                        <div>
                            <!-- [已修改] 移除 (必填) -->
                            <label for="jobCategory" class="block text-sm font-medium text-secondary-blue">職類</label>
                            <select id="jobCategory" name="jobCategory" required class="mt-1">
                                <option value="">-- 請選擇您的職類 --</option>
                                <option value="西醫">西醫</option>
                                <option value="牙醫">牙醫</option>
                                <option value="中醫">中醫</option>
                                <option value="護理">護理</option>
                                <option value="藥事">藥事</option>
                                <option value="醫事放射">醫事放射</option>
                                <option value="醫事檢驗">醫事檢驗</option>
                                <option value="營養">營養</option>
                                <option value="呼吸治療">呼吸治療</option>
                                <option value="聽力">聽力</option>
                                <option value="職能治療">職能治療</option>
                                <option value="物理治療">物理治療</option>
                                <option value="臨床心理">臨床心理</option>
                                <option value="語言治療">語言治療</option>
                                <option value="行政人員">行政人員</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <!-- 臨床教學經驗 -->
                        <div>
                            <!-- [已修改] 移除 (必填) -->
                            <label for="experience" class="block text-sm font-medium text-secondary-blue">臨床教學經驗</label>
                            <select id="experience" name="experience" required class="mt-1">
                                <option value="">-- 請選擇您的資歷 --</option>
                                <option value="1-5年">1-5年</option>
                                <option value="5-10年">5-10年</option> <!-- 已修正 -->
                                <option value="10年以上">10年以上</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 臨床教學職位 (可複選) -->
                    <div>
                        <label class="block text-sm font-medium text-secondary-blue">臨床教學職位 (可複選)</label>
                        <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-6">
                            <div class="flex items-center">
                                <input id="role-head" name="role" type="checkbox" value="教學訓練計畫主持人" class="p-2">
                                <label for="role-head" class="ml-2 block text-sm text-gray-800">教學訓練計畫主持人</label>
                            </div>
                            <div class="flex items-center">
                                <input id="role-chief" name="role" type="checkbox" value="科部教學負責人" class="p-2">
                                <label for="role-chief" class="ml-2 block text-sm text-gray-800">科部教學負責人</label>
                            </div>
                            <div class="flex items-center">
                                <input id="role-teacher" name="role" type="checkbox" value="臨床教師" class="p-2">
                                <label for="role-teacher" class="ml-2 block text-sm text-gray-800">臨床教師</label>
                            </div>
                        </div>
                    </div>

                    <!-- 午餐 -->
                    <div>
                        <!-- [已修改] 移除 (必填) -->
                        <label class="block text-sm font-medium text-secondary-blue">午餐</label>
                        <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-6">
                            <div class="flex items-center">
                                <input id="diet-meat" name="diet" type="radio" value="葷食" required class="p-2">
                                <label for="diet-meat" class="ml-2 block text-sm text-gray-800">葷食</label>
                            </div>
                            <div class="flex items-center">
                                <input id="diet-veg" name="diet" type="radio" value="素食" class="p-2">
                                <label for="diet-veg" class="ml-2 block text-sm text-gray-800">素食</label>
                            </div>
                            <div class="flex items-center">
                                <input id="diet-none" name="diet" type="radio" value="不需要" class="p-2">
                                <label for="diet-none" class="ml-2 block text-sm text-gray-800">不需要，可自理</label>
                            </div>
                        </div>
                    </div>

                    <!-- 報名按鈕區塊 -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-4">
                        <button type="submit" id="submitButton" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-brick-red hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brick-red transition-colors duration-200">
                            確認報名
                        </button>
                        
                        <button type="button" id="googleCalendarButton" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-secondary-blue bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-blue transition-colors duration-200">
                            <!-- SVG icon (calendar-days) -->
                            <svg class="w-5 h-5 mr-2 -ml-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor">
                                <path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64V24c0-13.3-10.7-24-24-24S16 10.7 16 24V64H0V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V64H336V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM0 192H448V448c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192zm384-96H64v32H384V96z"/>
                            </svg>
                            加入 Google 行事曆
                        </button>
                    </div>
                </form>
                
                <!-- 成功訊息提示 (預設隱藏) -->
                <div id="successMessage" class="hidden mt-6 p-4 rounded-md bg-green-100 border border-green-300 text-green-800">
                    <h3 class="font-medium">報名成功！</h3>
                    <!-- [已修改] 更新提示文字 -->
                    <p>感謝您的報名，我們已收到您的資料。將會在會前2周內寄出分組名單及教案等資訊給您！</p>
                </div>
                
                <!-- [新增] 失敗訊息提示 (預設隱藏) -->
                <div id="errorMessage" class="hidden mt-6 p-4 rounded-md bg-red-100 border border-red-300 text-red-800">
                    <h3 class="font-medium">報名失敗</h3>
                    <p>資料送出時發生錯誤，請稍後再試或聯繫主辦單位。</p>
                </div>
            </div>

            <!-- 
              區塊 3: 活動議程 
            -->
            <div id="agenda" class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-6 sm:p-8">
                  <h2 class="text-3xl font-bold tracking-tight text-secondary-blue mb-6">活動議程</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full text-base">
                        <thead class="bg-deep-blue text-white">
                            <tr>
                                <th scope="col" class="py-3.5 px-4 text-left font-semibold">時間</th>
                                <th scope="col" class="py-3.5 px-4 text-left font-semibold">主題</th>
                                <th scope="col" class="py-3.5 px-4 text-left font-semibold">地點</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">09:00 - 09:10</td>
                                <!-- 
                                  懸停提示實作：
                                  1. 父層 (td) 加上 "group relative"
                                  2. 提示文字 (span) 加上 "group-hover:opacity-100 ..."
                                -->
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    長官致詞
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">09:10 - 10:00</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    Lecture：CCC核心概念
                                    <!-- 懸停提示 (Tooltip) -->
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                        了解CCC運作
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>
                            
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">10:00 - 10:10</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    Coffee Break
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">-</td>
                            </tr>

                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">10:10 - 11:10</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    CCC信賴評定演練
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                        預計演練2個教案，委員解讀Portfolio並提出觀察、主席彙整意見、共同做出信賴評定
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳、552 會議室、554 會議室、556 會議室、558 會議室</td>
                            </tr>

                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">11:10 - 11:50</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    結果分享與討論交流
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">11:50 - 13:00</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    休息
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">-</td>
                            </tr>

                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">13:00 - 13:20</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    Lecture：補強計畫說明
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                        釐清問題、設定目標、選擇策略兼顧可行性
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">13:20 - 14:00</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    補強計畫設計演練
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                        針對上午學員CCC演練結果如何設計補強計畫
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>
                            
                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">14:00 - 14:10</td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    休息 / 換場
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">-</td>
                            </tr>

                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">14:10 - 14:40</td> <!-- 根據文件修正時間 14:20 -> 14:10 / 14:50 -> 14:40 -->
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    Lecture：ADAPT回饋模組
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                        介紹ADAPT回饋模組之概念講解、示範演練
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                            <tr class="bg-white">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">14:40 - 15:30</td> <!-- 根據文件修正時間 14:50 -> 14:40 / 15:40 -> 15:30 -->
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    ADAPT回饋演練
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs px-3 py-1.5 bg-deep-blue text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                        各組中再分為2小組，輪流扮演教師與學員，進行回饋演練
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                            <tr class="bg-light-khaki bg-opacity-40">
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">15:30 - 16:00</td> <!-- 根據文件修正時間 15:40 -> 15:30 -->
                                <td class="px-4 py-4 whitespace-nowrap text-gray-900 group relative">
                                    共識(各科下一步)與綜合討論
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-gray-700">國際會議廳</td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- 頁尾 -->
    <footer class="bg-deep-blue text-white mt-16 py-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>主辦單位：教學部</p>
            <p class="mt-1">聯絡人：楊宜婷 (分機: 57429；信箱: a80740@mail.chimei.org.tw)</p>
        </div>
    </footer>


    <!-- 
      JavaScript 程式碼
    -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- [修改] 表單提交邏輯 (連接 Google Apps Script) ---
            
            // ！！至關重要！！
            // [已更新] 替換為您提供的 Apps Script URL
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyvjyR4pxjBNeByB-N1XVoz-oDiZl22bk3oO_ZC1LODFKgKUW76oLeoAKsyZz3DNFvrMw/exec"; 

            const form = document.getElementById('registrationForm');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage'); // [新增]
            const submitButton = document.getElementById('submitButton');
            
            form.addEventListener('submit', function (e) {
                e.preventDefault(); // 防止表單的預設提交行為
                
                // 隱藏舊的提示訊息
                successMessage.classList.add('hidden');
                errorMessage.classList.add('hidden');

                // 禁用按鈕並顯示載入中
                submitButton.disabled = true;
                submitButton.textContent = '報名資料送出中...';
                
                const formData = new FormData(form);

                // 使用 fetch API 將資料 POST 到 Apps Script
                // 我們使用 'no-cors' 模式，這是一種「發送後不理會」的模式
                // 它允許我們跨域發送資料，但無法讀取 Apps Script 的「回應」
                // 因此 .then() 區塊總會執行（除非網路中斷）
                fetch(SCRIPT_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', // 關鍵：使用 no-cors 模式繞過 CORS 限制
                    body: formData
                })
                .then(() => {
                    // 由於使用 no-cors，我們假設請求已成功發送
                    // 顯示成功訊息
                    successMessage.classList.remove('hidden');
                    
                    // 禁用按鈕並更改文字
                    submitButton.textContent = '已完成報名';
                    submitButton.classList.add('bg-opacity-50', 'cursor-not-allowed');
                    
                    // 清空表單
                    form.reset();

                    // 滾動到成功訊息提示
                    successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                })
                .catch(error => {
                    // 只有在網路連線失敗時才會觸發
                    console.error('Fetch Error:', error);
                    errorMessage.classList.remove('hidden');
                    // 重新啟用按鈕
                    submitButton.disabled = false;
                    submitButton.textContent = '確認報名';
                });
            });

            // --- Google 行事曆邏輯 (保持不變) ---
            const googleCalendarButton = document.getElementById('googleCalendarButton');
            
            // [錯誤修正] 確保按鈕存在才綁定事件
            if (googleCalendarButton) {
                googleCalendarButton.addEventListener('click', function () {
                    
                    // 設定活動資訊
                    const event = {
                        title: "(CCC)臨床能力評估委員會工作坊",
                        startDate: "20251207T090000", // 2025-12-07 09:00 (UTC+8)
                        endDate: "20251207T160000",   // 2025-12-07 16:00 (UTC+8)
                        // 注意：Google 日曆會自動處理時區，因此我們提供當地時間
                        // 為了保險起見，我們指定時區
                        timeZone: "Asia/Taipei", 
                        location: "第五醫療大樓五樓國際會議廳、552會議室、554會議室、556會議室、558會議室",
                        description: "本次工作坊邀請臺大醫院楊志偉醫師指導，以CCC（Clinical Competency Committee，臨床能力評估委員會）之運作為主軸，強調信賴評定是以病人安全為核心的風險判斷而非單純分數評量。"
                    };

                    // 建立 Google Calendar 連結
                    // Google 日曆需要 UTC 時間，但它也能聰明地處理帶有 tzid 的本地時間
                    // 為了最廣泛的相容性，我們使用 dates 參數並指定 tzid
                    const baseUrl = "https://www.google.com/calendar/render?action=TEMPLATE";
                    const params = new URLSearchParams({
                        'text': event.title,
                        'dates': `${event.startDate}/${event.endDate}`,
                        'ctz': event.timeZone,
                        'details': event.description,
                        'location': event.location
                    });

                    const url = `${baseUrl}&${params.toString()}`;
                    
                    // 在新分頁中開啟
                    window.open(url, '_blank');
                });
            }


            // --- 導覽列滾動偵測 (Scroll-Spy) 邏輯 (保持不變) ---
            const sections = document.querySelectorAll('main > div > div[id]');
            const navLinks = document.querySelectorAll('nav a[data-navlink]');
            const offset = 160; // 偏移量，略大於固定標題的高度

            function onScroll() {
                let current = '';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - offset) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('text-brick-red', 'border-b-2', 'border-brick-red');
                    if (link.dataset.navlink === current) {
                        link.classList.add('text-brick-red', 'border-b-2', 'border-brick-red');
                    }
                });
            }
            
            window.addEventListener('scroll', onScroll);
            onScroll(); // 頁面載入時立即執行一次

        });
    </script>

</body>
</html>



